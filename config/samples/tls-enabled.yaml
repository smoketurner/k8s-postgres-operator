# PostgreSQL cluster with TLS encryption
# Requires cert-manager to be installed in the cluster
# See: https://cert-manager.io/docs/installation/
apiVersion: postgres-operator.smoketurner.com/v1alpha1
kind: PostgresCluster
metadata:
  name: pg-tls
  namespace: default
spec:
  version: "16"
  replicas: 3
  storage:
    size: 10Gi
  tls:
    enabled: true
    issuerRef:
      name: selfsigned-issuer  # Replace with your ClusterIssuer or Issuer
      kind: ClusterIssuer      # Use "Issuer" for namespace-scoped issuers
    # Optional: additional DNS names for the certificate
    # additionalDnsNames:
    #   - my-custom-hostname.example.com
    # Optional: certificate duration (default: 2160h / 90 days)
    # duration: "2160h"
    # Optional: renew before expiry (default: 360h / 15 days)
    # renewBefore: "360h"
  postgresqlParams:
    max_connections: "200"
---
# Example ClusterIssuer for self-signed certificates (for development)
# For production, use a real CA like Let's Encrypt
apiVersion: cert-manager.io/v1
kind: ClusterIssuer
metadata:
  name: selfsigned-issuer
spec:
  selfSigned: {}
